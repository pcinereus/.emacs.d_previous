#+STARTUP: overview



* Interface tweaks
  #+BEGIN_SRC emacs-lisp
                (setq-default inhibit-startup-message t                       ; Skip the startup screen
                              visible-bell t
                              ring-bell-function 'ignore
                              truncate-lines 0                                ; Truncate lines, don't wrap                                                             ;;
                              default-truncate-lines 0                                                                                                                                                                         ;;
                              font-lock-use-fonts '(or (mono) (grayscale))    ; Turn on syntax hilighting                                                              ;;
                              font-lock-use-colors '(color)                                                                                                                                                            ;;
                              font-lock-maximum-decoration t                                                                                                                                                           ;;
                              font-lock-maximum-size nil                                                                                                                                                               ;;
                              font-lock-auto-fontify t                                                                                                                                                                         ;;
                              global-font-lock-mode t                                                                                                                                                                          ;;
                              paren-mode 'sexp                                ; Highlight parenthesis                                                                          ;;
                              user-full-name "Murray Logan"                 ; Set name                                                                                                     ;;
                              user-mail-address "m.logan@aims.gov.au"      ; Set e-mail address                                                            ;;
                              query-user-mail-address nil                                                                                                                                                          ;;
                              display-warning-minimum-level 'error            ; Turn off anoying warning messages                                          ;;
                              delete-key-deletes-forward t                    ; Make delete key work normally                                                      ;;
                              column-number-mode t                            ; Display line and column numbers                                                ;;
                              line-number-mode t                                                                                                                                                                               ;;
                              tab-width 4                                     ; Set tab stops                                                                                      ;;
                              tab-stop-list '(4 8 12 16 20 24 28 32 36 40 44                                                                                                                           ;;
                                                48 52 56 60 64 68 72 76 80 84)                                                                                                                     ;;
                              toolbar-print-function 'ps-print-buffer-with-faces ; Set the print button to print nice PS                               ;;
                              ps-line-number t                                                                                                                                                                                     ;;
                              ps-n-up-printing 2                                                                                                                                                                               ;;
                              ps-print-color-p nil                                                                                                                                                                         ;;
                              display-time-day-and-date t                     ; Display the time and date on the mode line                         ;;
                              case-fold-search t                              ; Fold case on searches                                                                      ;;
                              buffers-menu-sort-function 'sort-buffers-menu-by-mode-then-alphabetically ; Buffers menu settings                ;;
                              buffers-menu-grouping-function 'group-buffers-menu-by-mode-then-alphabetically                                                           ;;
                              buffers-menu-submenus-for-groups-p t                                                                                                                                         ;;
                              buffers-tab-filter-functions nil                ; Buffers tab is flat                                       ;;
                              ;;frame-title-format '(buffer-file-name "%f" ("%b")) ; Make the title bar display the buffer name           ;;
                              frame-title-format '(buffer-file-name "%b" ("%b")) ; Make the title bar display the buffer name             ;;
                              ;;               ispell-program-name "aspell"                    ; Use aspell to spell check                             ;;
                              ;;               initial-scratch-message nil                     ; I hate the initial scratch message!           ;;
                              )                                                                                                                                                                                                                        ;;

        (defalias 'yes-or-no-p 'y-or-n-p)
        (set-face-attribute 'default nil                               ;;
                                    :family "DejaVu Sans Mono" :height 80)  ;;
        (tool-bar-mode -1)
        ;;Ensures that the region betwen matching brackets are highlighted                                                                                                          ;;
        (show-paren-mode 1)   

        ;; Date and time in the emacs status bar
        (setq display-time-day-and-date t
                  display-time-24hr-format t)
        (display-time)
        (setq dired-dwim-target t)
        ;;(require 'sunrise-commander)

    ;; Always highlight the current row in a buffer
    (global-hl-line-mode 1)

  #+END_SRC
* Multiple cursors
  #+BEGIN_SRC emacs-lisp
    (use-package multiple-cursors
      :ensure t
      :bind (
             ("C-S-c C-S-c" . mc/edit-lines)
             ("C->" . mc/mark-next-like-this)
             ("C-<" . mc/mark-previous-like-this)
             ("C-c C-<" . mc/mark-all-like-this)
             ("C-." . mc/mark-more-like-this-extended)
             ("C-c m" . mc/mark-all-in-region)
             )
      )
  #+END_SRC

* Browser settings
  #+BEGIN_SRC emacs-lisp
  (setq browse-url-generic-program (executable-find "conkeror"))
  (setq browse-url-browser-function 'browse-url-generic)
  #+END_SRC


* Murray's menu
  #+BEGIN_SRC emacs-lisp
    ;; Function Menu
    ;; -------------
    ;; This sets up a really funky menu that displays the names of my functions
    ;; and procedures on the menu, puts the active one on the modeline and lets
    ;; me easily jump between functions.  Cool.  Only works in XEmacs though.
    ;;


    ;; strip-trailing-space
    ;; --------------------
    ;; Strip out trailing whitespace from all lines in a buffer.
    ;;
    (defun strip-trailing-space ()
      "Strip out trailing whitespace from all lines in buffer."
      (interactive)
      (save-excursion
        (goto-char (point-min))
        (while (re-search-forward "[ \t]+$" nil t)
          (replace-match "" t t))))
    (define-key global-map [(control ?{) ?t] 'strip-trailing-space) ; Bind to C-{ t

    ;; show-ascii-chart
    ;; ----------------
    ;; Display a helpful ASCII reference chart when called.  Useful for quickly
    ;; double checking or looking up character codes.  Usually the
    ;; what-cursor-position (C-x =) is faster for spot lookups of the number
    ;; for a character here and there.  It's terrible, however, for finding the
    ;; character given a number.
    ;;
    (defun show-ascii-chart ()
      "Display a helpful ASCII chart."
      (interactive)
      (let ((chart (concat
                    "==============================================================================\n"
                    "                        Common ASCII Codes And Escapes\n"
                    "==============================================================================\n"
                    "Char  Dec Hex Oct Esc Name             | Char  Dec Hex Oct Esc Name\n"
                    "------------------------------------------------------------------------------\n"
                    "(nul)   0  00 000 \\0  Null             | (np)   12  0c 014 \\f  Form Feed\n"
                    "(bel)   7  07 007 \\a  Audible Alert    | (cr)   13  0d 015 \\r  Carriage Return\n"
                    "(bs)    8  08 010 \\b  Backspace        | (sp)   32  20 040     Space\n"
                    "(ht)    9  09 011 \\t  Horizontal Tab   | 0      48  30 060     Zero\n"
                    "(nl)   10  0a 012 \\n  New Line         | A      65  41 101     Capital A\n"
                    "(vt)   11  0b 013 \\v  Vertical Tab     | a      97  61 141     Lowercase a\n"
                    "\n"
                    "=============================================================================\n"
                    "                                 ASCII Table\n"
                    "=============================================================================\n"
                    "Char  Dec Hex Oct | Char  Dec Hex Oct | Char  Dec Hex Oct | Char  Dec Hex Oct\n"
                    "-----------------------------------------------------------------------------\n"
                    "(nul)   0  00 000 | (sp)   32  20 040 | @      64  40 100 | `      96  60 140\n"
                    "(soh)   1  01 001 | !      33  21 041 | A      65  41 101 | a      97  61 141\n"
                    "(stx)   2  02 002 | \"      34  22 042 | B      66  42 102 | b      98  62 142\n"
                    "(etx)   3  03 003 | #      35  23 043 | C      67  43 103 | c      99  63 143\n"
                    "(eot)   4  04 004 | $      36  24 044 | D      68  44 104 | d     100  64 144\n"
                    "(enq)   5  05 005 | %      37  25 045 | E      69  45 105 | e     101  65 145\n"
                    "(ack)   6  06 006 | &      38  26 046 | F      70  46 106 | f     102  66 146\n"
                    "(bel)   7  07 007 | '      39  27 047 | G      71  47 107 | g     103  67 147\n"
                    "(bs)    8  08 010 | (      40  28 050 | H      72  48 110 | h     104  68 150\n"
                    "(ht)    9  09 011 | )      41  29 051 | I      73  49 111 | i     105  69 151\n"
                    "(nl)   10  0a 012 | *      42  2a 052 | J      74  4a 112 | j     106  6a 152\n"
                    "(vt)   11  0b 013 | +      43  2b 053 | K      75  4b 113 | k     107  6b 153\n"
                    "(np)   12  0c 014 | ,      44  2c 054 | L      76  4c 114 | l     108  6c 154\n"
                    "(cr)   13  0d 015 | -      45  2d 055 | M      77  4d 115 | m     109  6d 155\n"
                    "(so)   14  0e 016 | .      46  2e 056 | N      78  4e 116 | n     110  6e 156\n"
                    "(si)   15  0f 017 | /      47  2f 057 | O      79  4f 117 | o     111  6f 157\n"
                    "(dle)  16  10 020 | 0      48  30 060 | P      80  50 120 | p     112  70 160\n"
                    "(dc1)  17  11 021 | 1      49  31 061 | Q      81  51 121 | q     113  71 161\n"
                    "(dc2)  18  12 022 | 2      50  32 062 | R      82  52 122 | r     114  72 162\n"
                    "(dc3)  19  13 023 | 3      51  33 063 | S      83  53 123 | s     115  73 163\n"
                    "(dc4)  20  14 024 | 4      52  34 064 | T      84  54 124 | t     116  74 164\n"
                    "(nak)  21  15 025 | 5      53  35 065 | U      85  55 125 | u     117  75 165\n"
                    "(syn)  22  16 026 | 6      54  36 066 | V      86  56 126 | v     118  76 166\n"
                    "(etb)  23  17 027 | 7      55  37 067 | W      87  57 127 | w     119  77 167\n"
                    "(can)  24  18 030 | 8      56  38 070 | X      88  58 130 | x     120  78 170\n"
                    "(em)   25  19 031 | 9      57  39 071 | Y      89  59 131 | y     121  79 171\n"
                    "(sub)  26  1a 032 | :      58  3a 072 | Z      90  5a 132 | z     122  7a 172\n"
                    "(esc)  27  1b 033 | ;      59  3b 073 | [      91  5b 133 | {     123  7b 173\n"
                    "(fs)   28  1c 034 | <      60  3c 074 | \\      92  5c 134 | |     124  7c 174\n"
                    "(gs)   29  1d 035 | =      61  3d 075 | ]      93  5d 135 | }     125  7d 175\n"
                    "(rs)   30  1e 036 | >      62  3e 076 | ^      94  5e 136 | ~     126  7e 176\n"
                    "(us)   31  1f 037 | ?      63  3f 077 | _      95  5f 137 | (del) 127  7f 177\n")))
        (if (fboundp 'with-displaying-help-buffer)
            (with-displaying-help-buffer
             (lambda ()
               (princ chart))
             "ASCII Chart")
          (with-output-to-temp-buffer "ASCII Chart"
            (princ chart)))))

    ;; goto-longest-line
    ;; -----------------
    ;; Sometimes for code is nice to find lines that are pushed out too far.
    ;; This function moves point to the end of the longest line.  Also handy
    ;; for lining up columns of text when used in a narrowed buffer.
    ;;
    (defun goto-longest-line ()
      "Finds the longest line and puts the point there."
      (interactive)
      (let ((width 0)
            (pos 0))
        (goto-char (point-min))
        (while (= (forward-line 1) 0)
          (end-of-line)
          (let ((curwid (current-column)))
            (unless (<= curwid width)
              (setq width curwid)
              (setq pos (point)))))
        (goto-char pos)))

    ;; goto-matching-paren
    ;; -------------------
    ;; If point is sitting on a parenthetic character, jump to its match.
    ;; This matches the standard parenthesis highlighting for determining which
    ;; one it is sitting on.
    ;;
    (defun goto-matching-paren ()
      "If point is sitting on a parenthetic character, jump to its match."
      (interactive)
      (cond ((looking-at "\\s\(") (forward-list 1))
            ((progn
               (backward-char 1)
               (looking-at "\\s\)")) (forward-char 1) (backward-list 1))))
     (define-key global-map [(control ?{) ?p] 'goto-matching-paren) ; Bind to C-i p

    (defun R-xelatex ()
      ;;  (interactive "sfilename:?")
      (interactive)
      (setq var (split-string (read-from-minibuffer "Enter filename: "nil nil nil nil nil nil) " "))
      (setq name (car var))
      (shell-command "mkdir figures")
      (shell-command "mkdir cache")
      (shell-command "mkdir data")
      (find-file "Makefile")
      (xelatex-rnw-makefile name)
      (save-buffer)
      (kill-buffer "Makefile")
      (find-file (concat name ".rnw"))
      (xelatex-rnw-skeleton)
      (save-buffer)
      )

    (define-skeleton xelatex-rnw-makefile 
      "Inserts a basic noweb xelatex makefile skeleton into a buffer."
      ;;"filename: "
      ;;(find-file "Makefile")
      ".SUFFIXES: .rnw .tex .pdf .dvi .ps\n"
      "RNWFILES = $(wildcard *.rnw)\n"
      "TEX = $(patsubst %.rnw,%.tex,$(RNWFILES)) #$(wildcard *.tex)\n"
      "TARGET = " name "\n"
      "LATEX_ARGS=--interaction=nonstopmode --output-driv=\"xdvipdfmx -vv -V 4\"\n"
      ;;"LATEX_ARGS=--interaction=batchmode --output-driv=\"xdvipdfmx -vv -V 4\"\n"
      ;;  "LATEX_ARGS=\"-interaction=nonstopmode\"\n"
      "LATEX=xelatex\n"
      "RERUNBIB = \"No file.*\\\ .bbl|Citation.*undefined\"\n"
      "RERUNINDEX = \"No file.*\\\ .ind\"\n\n"

      "PDFS=$(wildcard figures/*.pdf)\n"
      "JPGS=$(patsubst %.pdf, %.jpg, $(PDFS))\n"
      "EPSS=$(patsubst %.pdf, %.eps, $(PDFS))\n"
      "CONVERT = convert -density 300 -resize 33% -background white -flatten\n\n"

      "MASTER = " str ".pdf\n" 
      "DEPENDS = $(TARGET).tex\n\n"
      "$(MASTER): $(DEPENDS)\n\n"
  
      "%.tex: %.rnw\n"
      "             echo \"library(pgfSweave); setCacheDir('cache'); pgfSweave(\\\"$<\\\")\" | R --no-save --no-restore\n\n"
      "             echo \"Stangle(\\\"$<\\\")\" | R --no-save --no-restore\n\n"
    ;;  "       echo \"library(pgfSweave); setCacheDir('cache'); pgfSweave(\\\"$<\\\", graphics.only=T,compile.tex=F,pdf=F)\" | R --no-save --no-restore\n\n"
    ;;  "           echo \"library(cacheSweave); library(highlight); setCacheDir('cache'); Sweave(\\\"$<\\\", driver = HighlightWeaveLatex(boxes=T,bg=rgb(255,255,204,max=255)))\" | R --no-save --no-restore \n"
    ;;  "             echo \"library(cacheSweave); setCacheDir('cache'); Sweave(\\\"$<\\\", driver = cacheSweaveDriver)\" | R --no-save --no-restore\n\n"
    ;;  "           echo \"Stangle(\\\"$<\\\")\" | R --no-save --no-restore\n\n"
    ;;  "           echo \"sed s/,.size=scriptsize//g \\\"$<\\\" > junk\" \n"
    ;;  "           echo \"Stangle(\\\"junk\\\",output=\\\"$(TARGET).R\\\")\" | R --no-save --no-restore\n\n"
    ;;  "           echo \"rm(junk)\" \n"
 
      "$(TARGET).pdf: $(TEX)\n"
      "     $(LATEX) $(LATEX_ARGS) $(TARGET).tex;\n"
      "     while \\\ egrep -c $(RERUNBIB) $(TARGET).log; \\\ \n"
      "     do \\\ \n"
      "             bibtex $(TARGET); \\\ \n"
      "             $(LATEX) $(LATEX_ARGS) $(TARGET).tex; \\\ \n"
      "     done\n"
      "     while \\\ grep -q \"Rerun to get cross-references right.\" \\\ \n"
      "     $(TARGET).log; \\\ \n"
      "     do \\\ \n"
      "             $(LATEX) $(LATEX_ARGS) $(TARGET).tex; \\\ \n"
      "     done\n"
      "     $(LATEX) $(LATEX_ARGS) $(TARGET).tex;\n\n"
  
      "figs: $(JPGS) $(EPSS)\n\n"

      "%.jpg: %.pdf\n"
      "             @echo ** Building jpg images from pdf versions**\n"
      "             $(CONVERT) $< $@\n\n"

      "%.eps: %.pdf\n"
      "             pdf2ps -dLanguageLevel=3 $< $@\n\n"

      "figures::\n" 
      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             convert -density 300 -quality 100 $${image_file} $${image_file}.jpg; \\\ \n"
      "             done;\n\n"

      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             convert -density 300 -quality 100 $${image_file} $${image_file}.tiff; \\\ \n"
      "             done;\n\n"

      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             pdftops -eps -level3 $${image_file}; \\\ \n"
      "             done;\n\n"

      "zip:\n"
      "             zip $(TARGET).zip $(TARGET).pdf *.R figures/*.pdf figures/*.jpg figures/*.eps \n"

      "clean:\n"
      "     rm *.toc *.aux *.pdf *.ps *.eps *.log *.lof *.bib *.bbl *.blg *.dvi *.tex *.map\n"
  
      )

    ;;-- xelatex template ########################################################-------------------------------------------------------------------------------------
    (define-skeleton xelatex-rnw-skeleton
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "\\title{" str "}\n"
      "\\documentclass[a4paper]{article}\n"
      "\\usepackage[T1]{fontenc}        %for specifying any fonts\n"
      "\\usepackage{calligra}\n"
      "\\usepackage{rotating}           %for sideways tables\n"
      "\\usepackage{marvosym}\n"
      "\\usepackage{listings}                   %provides lstset for formating inserted computer code\n"
      "\\usepackage{tabularx}           %for tables\n"
      "\\usepackage{color,graphicx}\n"
      "\\usepackage{tikz}\n"
      "\\usetikzlibrary{backgrounds}\n"
      "\\usetikzlibrary{shadows}\n"
      "\\usepackage{wrapfig}\n"
      "\\usepackage[lmargin=1.75cm,rmargin=1.5cm, tmargin=1.5cm, a4paper]{geometry}\n"
      "%-----Define Provision for bibliography-----------\n"
      "\\usepackage{natbib}\n"
      "\\usepackage{bibentry}\n"
      "%-------------------------------------------------\n"
      "\\usepackage{bbding}\n"
      "%---Define some colors--------------------------\n"
      "\\definecolor{backgroundColor}{HTML}{CC3300}\n"
      "\\definecolor{linkcolour}{HTML}{393939} %{FF0080}    %light purple link for the email\n"
      "\\definecolor{shade}{HTML}{D4D7FE}           %light blue shade\n"
      "\\definecolor{text1}{HTML}{2b2b2b}           %text is almost black\n"
      "\\definecolor{headings}{HTML}{0099e3}        %light blue\n"
      "\\definecolor{lightgray}{gray}{0.9}          %light gray\n"
      "\\definecolor{rinput}{HTML}{FF0000}     %dark blue\n"
      "\\definecolor{routput}{HTML}{033197}     %dark blue\n"
      "\\definecolor{rbackground}{HTML}{FFFFCC}\n"
      "%-------------------------------------------------\n"
      "\\usepackage{hyperref}\n"
      "\\hypersetup{colorlinks,breaklinks,urlcolor=linkcolour,linkcolor=linkcolour, citecolor=routput}\n"
      "\\renewcommand*\\sfdefault{lmssq}\n"
      "%-Redefine the section title formats--------------\n"
      "\\usepackage{titlesec}\n"
      "\\titleformat{\\section}{\\Large\\sf\\bfseries\\raggedright\\color{headings}\\thesection. }{}{0em}{}[\\titlerule]\n"
      "\\titlespacing{\\section}{0pt}{3pt}{3pt}\n"
      "\\titleformat{\\subsection}{\\large\\sf\\bfseries\\itshape\\raggedright\\color{headings}\\thesubsection. }{}{0em}{}\n"
      "\\titlespacing{\\subsection}{0pt}{3pt}{3pt}\n"
      "\\titleformat{\\subsubsection}{\\normalsize\\sf\\bfseries\\itshape\\raggedright\\color{headings}\\thesubsubsection. }{}{0em}{}\n"
      "\\titlespacing{\\subsubsection}{0pt}{3pt}{3pt}\n"
      "%-------------------------------------------------\n"
      "%---Define a new list style-----------------------\n"
      "\\newenvironment{my_itemize}\n"
      "\{\\begin{list}{\\labelitemi}{\\leftmargin=1em}\n"
      "\}\n"
      "\{\\end{list}}\n"
      "%-------------------------------------------------\n"
      "\\usepackage{eso-pic}\n"
      "%--Put a silhouette at the bottom of the page-----\n"
      "\\newcommand\\BackgroundPic{\n"
      "\\put(130,-335){\n"
      "\\parbox[b][\\paperheight]{\\paperwidth}{%\n"
      "\\vfill\n"
      "\\centering\n"
      "\\includegraphics{/home/murray/Work/Resume/Murray/Biostatistician/seal_silhouette.jpg}%\n"
      "\\vfill\n"
      "\}}}\n"
      "%-------------------------------------------------\n"
      "%--Put a blue bar on the left hand side of the page---\n"
      "\\newcommand\\SidePic{\n"
      "\\put(-30,\\pageheight){\n"
      "\\includegraphics[width=23mm, height=31cm]{/home/murray/Work/Resume/blueSide.png}\n"
      "\\hspace{-2mm}{\\color{gray}\\rule{.5mm}{300mm}}{\\color{black}\\rule{.25mm}{300mm}}\n"
      "\}}\n"
      "%-------------------------------------------------\n"
      "%--Place   DRAFT ONLY  on each page---------------\n"
      "\\usepackage{fontspec}\n"
      "\\newcommand\\DraftWord{\n"
      "\\AtTextCenter{%\n"
      "\\makebox(0,0)[c]{\\resizebox{\\textwidth}{!}{%\n"
      "\\rotatebox{45}{\\textsf{\\textbf{\\color{lightgray}{\\fontspec[ExternalLocation=/home/murray/.fonts/]{angelina.TTF}\\fontsize{80pt}{0pt}\\selectfont Draft Only}}}}\n"
      "\}}\n"
      "\}\n"
      "\}\n"
      "%-------------------------------------------------\n"
      "\\pretolerance=2000\n"
      "\\tolerance=2000\n"
      "%\\usepackage[noae]{/usr/local/lib/R/share/texmf/Sweave}\n"
      "\\usepackage[noae]{Sweave}\n"
      "%--Alter the default format of the R code/output--\n"
      "\\DefineVerbatimEnvironment{Sinput}{Verbatim}{fontsize=\\scriptsize,fontshape=sl,formatcom={\\color{rinput}}}\n"
      "\\DefineVerbatimEnvironment{Soutput}{Verbatim}{\\vspace{-2em},fontsize=\\scriptsize,formatcom={\\color{routput}}}\n" 
      "\\DefineVerbatimEnvironment{Scode}{Verbatim}{fontshape=sl,formatcom={\\color{headings}}}\n" 
      "\\fvset{listparameters={\\setlength{\\topsep}{1em}}}\n"
      "\\renewenvironment{Houtput}{%\n"
      " \\begin{scriptsize}\n"
      "    \\color{routput}\n"
      "    \\par\n"
      "    \\tikzexternaldisable\n"
      "    \\begin{tikzpicture}\n"
      "      \\node[fill=rbackground,rectangle,minimum width=0.9\\textwidth] (m)\n"
      "      \\bgroup\\begin{minipage}{0.85\\textwidth}%\n"
      "}\n"
      "{%\n"
      "  \\end{minipage}\\egroup;\n"
      "  \\draw[dashed] (m.south west) rectangle (m.north east);\n"
      "  \\end{tikzpicture}\n"
      "  \\end{scriptsize}\n"
      "\\\\ \n" 
      "}\n"

      "\\definecolor{highlightBg}{rgb}{1,1,0.8}\n"
      "\\definecolor{highlightBorder}{rgb}{0,0,0}\n"

      "\\renewenvironment{Hchunk}{% \n"
      " \\color{routput}\n"
      " \\par\n"
      " \\begin{tikzpicture}\n"
      "  \\node[fill=rbackground,rectangle,minimum width=0.9\\textwidth] (m)\n"
      "  \\bgroup\\begin{minipage}{0.85\\textwidth}%\n"
      "}{%\n"
      "  \\end{minipage}\\egroup;\n"
      "  \\draw[dashed] (m.south west) rectangle (m.north east);\n"
      "  \\end{tikzpicture}\\\\ \n" 
      "}\n"

      "%\\newenvironment{elaboration}{%\n"
      "%  \\par\n"
      "%  \\begin{tikzpicture}\n"
      "%  \\node[fill=rbackground,rectangle,minimum width=0.9\textwidth] (m)\n"
      "%  \\bgroup\\begin{minipage}{0.85\\textwidth}%\n"
      "% }{%\n"
      "%  \\end{minipage}\\egroup;\n"
      "%  \\draw[dashed] (m.south west) rectangle (m.north east);\n"
      "%  \\end{tikzpicture}\\\\ \n"
      "% }\n"

      "%\\makeatletter\n"
      "%\\renewenvironment{Schunk}{\\begin{elaboration}}{\\end{elaboration}}\n"
      "%\\makeatother\n"

      "%\\renewenvironment{Schunk}{\\vspace{\\topsep}}{\\vspace{\\topsep}}\n"
      "%-------------------------------------------------\n"
      "%--Change the format of the captions--------------\n"
      "% Different font in captions\n"
      "\\newcommand{\\captionfonts}{\\small\\sf}\n"
      "\\makeatletter  % Allow the use of @ in command names\n"
      "\\long\\def\\@makecaption#1#2{%\n"
      "\\vskip\\abovecaptionskip\n"
      "\\sbox\\@tempboxa{{\\captionfonts #1: \\em#2}}%\n"
      "\\ifdim \\wd\\@tempboxa >\\hsize\n"
      "{\\captionfonts #1: \\em#2\\par}\n"
      "\\else\n"
      "\\hbox to\\hsize{\\hfil\\box\\@tempboxa\\hfil}%\n"
      "\\fi\n"
      "\\vskip\\belowcaptionskip}\n"
      "\\makeatother   % Cancel the effect of \\makeatletter\n"
      "%-------------------------------------------------\n"
      "%--Change the page formatting---------------------\n"
      "% Change the format of the page numbers\n"
      "\\usepackage{fancyhdr}\n"
      "\\pagestyle{fancy}\n"
      "\\fancyhf{} % clear all header and footer fields\n"
      "\\fancyhead[RE,LO]{\\hfill\\bfseries\\sf \\thepage}\n"
      "\\fancyfoot[RE,LO]{\\hfill\\bfseries\\sf \\thepage}\n"
      "\\renewcommand{\\headrulewidth}{0pt}\n"
      "%-------------------------------------------------\n"
      "%--Change the name used for the table of contents-\n"
      "\\renewcommand{\\contentsname}{Table of contents}\n"
      "%-------------------------------------------------\n"

      "\\setlength\\parindent{0pt}\n"
      "\\setmonofont[Scale=MatchLowercase, ExternalLocation=\\string~/Dropbox/Config/Fonts/]{DejaVuSansMono.ttf}\n"
      "%\\setmonofont[Scale=MatchLowercase]{DejaVu Sans Mono}\n"
      "\\renewcommand{\\hlcomment}[1]{\\textcolor[HTML]{3C802C}{#1}}%\n"
      "\\renewcommand{\\hlstring}[1]{\\textcolor[HTML]{ED7722}{#1}}%\n"
      "\\renewcommand{\\hlfunctioncall}[1]{\\textcolor[HTML]{053369}{#1}}%\n"
      "\\renewcommand{\\hlnumber}[1]{\\textcolor[HTML]{0F20F6}{#1}}%\n"
      "\\renewcommand{\\hlkeyword}[1]{\\textcolor[HTML]{AA1F63}{\\textbf{#1}}}%\n"
      "\\renewcommand{\\hlargument}[1]{\\textcolor[HTML]{053369}{#1}}%\n"

      "\\setbox\\hlnormalsizeboxopenbrace=\\hbox{\\begin{scriptsize}\\verb.{.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxclosebrace=\\hbox{\\begin{scriptsize}\\verb.}.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxlessthan=\\hbox{\\begin{scriptsize}\\verb.<.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxdollar=\\hbox{\\begin{scriptsize}\\verb.$.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxunderscore=\\hbox{\\begin{scriptsize}\\verb._.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxand=\\hbox{\\begin{scriptsize}\\verb.&.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxhash=\\hbox{\\begin{scriptsize}\\verb.#.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxat=\\hbox{\\begin{scriptsize}\\verb.@.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxbackslash=\\hbox{\\begin{scriptsize}\\verb.\\.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxgreaterthan=\\hbox{\\begin{scriptsize}\\verb.>.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxpercent=\\hbox{\\begin{scriptsize}\\verb.%.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxhat=\\hbox{\\begin{scriptsize}\\verb.^.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxsinglequote=\\hbox{\\begin{scriptsize}\\verb.'.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxbacktick=\\hbox{\\begin{scriptsize}\\verb.`.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxhat=\\hbox{\\begin{scriptsize}\\verb.^.\\end{scriptsize}}%\n"

      "\\begin{document}\n"
      "\\SweaveOpts{prefix.string=figures/fig,keep.source=FALSE}\n"
      "\\sf\n"
      "\\AddToShipoutPicture{\\BackgroundPic}\n"
      "\\AddToShipoutPicture{\\SidePic}\n"
      "\\AddToShipoutPicture{\\DraftWord}\n"
      "%<<Setcache - THIS CODE SHOULD BE IGNORED, echo=F>>=\n"
      "%# The following step requires the cacheSweave package\n"
      "%setCacheDir(\"cache\")\n"
      "%reSQL<-TRUE\n"
      "%@\n\n" 

      "\\lstset{basicstyle=\\small\\ttfamily,columns=fixed,numbers=left,numberstyle=\\tiny,xleftmargin=3ex,xrightmargin=3ex,frame=lines,float=htb!}\n"
      "\n" _ "\n\n"
      "<<Rwidth, echo=FALSE, results=\"hide\">>=\n"
      "options(width=110)\n"
      "@\n\n"
      "\\noindent\\begin{minipage}[t]{\\linewidth}{%centering\n"
      "{\\noindent\\sffamily\\bfseries\\Huge " str "\n"
      "}\\\\[1em]\n"
      "\\large{Murray Logan}\\\\ \n"
      "\\normalsize\\textit{\\today}\n"
      "\\end{minipage}\\\\ \n" 

      "\\rule{\\linewidth}{2pt}\\\\[2pt]\n"
  
      "\\titleformat{\\section}{\\Large\\sf\\bfseries\\raggedright\\color{headings}}{}{0em}{}[\\titlerule]\n"
      "\\noindent\n"
      "{\\tikzexternaldisable\n"
      "\\begin{tikzpicture}\n"
      "\\node [fill=shade,rounded corners=5pt]\n"
      "{\n"
      "\\begin{minipage}[t]{\\textwidth}\n"  
      "\\tableofcontents\n"
      "\\end{minipage}\n"
      "};\n"
      "\\end{tikzpicture}\n"
      "}\n"
      "\\titleformat{\\section}{\\Large\\sf\\bfseries\\raggedright\\color{headings}\\thesection. }{}{0em}{}[\\titlerule]\n"
      "\\section{Data importation and preparation}\n"
      "\\subsection{Read in data}\n"
      "<<ReadData>>=\n"
      "data <- read.table('data.csv', header=T, sep=',', strip.white=T)\n"
      "@\n"
      "\\subsection{Prepare data}\n"
      "\\noindent\n"
      "{\\tikzexternaldisable\n"
      "\\begin{tikzpicture}\n"
      "\\node [fill=shade,rounded corners=5pt]\n"
      "{\n"
      "\\begin{minipage}[t]{\\textwidth}\n"  
      "\\textbf{Conclusions}.\n"
      "\\end{minipage}\n"
      "};\n"
      "\\end{tikzpicture}}\n"

      "\\addcontentsline{toc}{section}{References and additional reading}\\titleformat{\\section}{\\Large\\sf\\bfseries\\raggedright\\color{headings}}{}{0em}{}[\\titlerule]\n"
      "\\bibliographystyle{/home/murray/Work/References/ecology}\n"
      "\\bibliography{/home/murray/Work/References/References}\n" 
      "~\\\\[2em]"
      "\\addcontentsline{toc}{section}{Appendices}\n"
      "\\appendix{\\Large\\sf\\bfseries\\raggedright\\color{headings} Appendicies \\\\[0.3em]\\titlerule\\\\[0.1em]}\n"
      "\\titleformat{\\subsection}{\\large\\sf\\bfseries\\itshape\\raggedright\\color{headings}\\Alph{subsection}. }{}{0em}{}\n"
      "\\renewcommand{\\thesubsection}    {\\Alph{subsection}}\n"
      "\\subsection{Production notes}\n"
      "\\noindent This document was produced using \\LaTeX~ and \\Sexpr{print(version$version.string)} via Sweave, on a system:$\\Sexpr{print(version$platform)}$.\n"
      "The complete annotated R syntax is in the accompanying " name ".R file.\n"

      "%<<CreateRFile - THIS CODE SHOULD BE IGNORED, echo=FALSE>>=\n"
      "%Stangle('"name ".rnw')\n"
      "%@\n" 
      "\\end{document}\n")
    ;;------------END OF R-xelatex-----------------------------------------------------------------------------------------------------------------------------------



    ;; ----Start of elsarticle-R---------------------------------------------------
    (defun elsarticle-R()
      ;;  (interactive "sfilename:?")
      (interactive)
      (setq var (split-string (read-from-minibuffer "Enter filename: "nil nil nil nil nil nil) " "))
      (setq name (car var))
      (setq author (read-string "Document author: " nil nil nil nil))
      (shell-command "mkdir figures")
      (shell-command "mkdir cache")
      (shell-command "mkdir data")
      (shell-command "mkdir scripts")
      (shell-command "mkdir fonts")
      (find-file "Makefile")
      (elsarticle-R-makefile name)
      (save-buffer)
      (kill-buffer "Makefile")
      (find-file (concat name ".Rmd"))
      (elsarticle-R-skeleton)
      (save-buffer)
      )

    ;;--------------------------------------------------------------------------------------------


    ;; ----Start of small-markdown-knitr-pandoc---------------------------------------------------
    (defun small-markdown-knitr-pandoc ()
      ;;  (interactive "sfilename:?")
      (interactive)
      (setq var (split-string (read-from-minibuffer "Enter filename: "nil nil nil nil nil nil) " "))
      (setq name (car var))
      (setq author (read-string "Document author: " nil nil nil nil))
      (shell-command "mkdir figures")
      (shell-command "mkdir cache")
      (shell-command "mkdir data")
      (shell-command "mkdir scripts")
      (shell-command "mkdir fonts")
      (find-file "Makefile")
      (markdown-knitr-pandoc-makefile name)
      (save-buffer)
      (kill-buffer "Makefile")
      (find-file (concat name ".Rmd"))
      (markdown-knitr-pandoc-skeleton)
      (save-buffer)
      )

    ;;--------------------------------------------------------------------------------------------

    ;; ----Start of large-markdown-knitr-pandoc---------------------------------------------------
    (defun large-markdown-knitr-pandoc ()
      ;;  (interactive "sfilename:?")
      (interactive)
      (setq var (split-string (read-from-minibuffer "Enter filename: "nil nil nil nil nil nil) " "))
      (setq name (car var))
      (setq author (read-string "Document author: " nil nil nil nil))
      (shell-command "mkdir figures")
      (shell-command "mkdir cache")
      (shell-command "mkdir data")
      (shell-command "mkdir scripts")
      (shell-command "mkdir fonts")
      (find-file "Makefile")
      (markdown-knitr-pandoc-makefile name)
      (save-buffer)
      (kill-buffer "Makefile")
    ;;  (find-file (concat name ".Rmd"))
    ;;  (markdown-knitr-pandoc-skeleton)
    ;;  (save-buffer)
      (find-file (concat "01-" name "-import.Rmd"))
      (markdown-knitr-pandoc-skeleton-01)
      (save-buffer)
      (find-file "helperFunctions.R")
      (markdown-knitr-pandoc-skeleton-helperFunctions)
      (save-buffer)
      (find-file (concat "02-" name "-processing.Rmd"))
      (markdown-knitr-pandoc-skeleton-02)
      (save-buffer)
      (find-file (concat "05-" name "-analysis.Rmd"))
      (markdown-knitr-pandoc-skeleton-05)
      (save-buffer)
      (save-buffer)
      (find-file (concat "07-" name "-summaries.Rmd"))
      (markdown-knitr-pandoc-skeleton-07)
      (save-buffer)
      (find-file (concat "09-" name "-appendix.Rmd"))
      (markdown-knitr-pandoc-skeleton-09)
      (save-buffer)
      (find-file "templates")
      (markdown-knitr-templates)
      (save-buffer)
      )


    (define-skeleton elsarticle-R-makefile 
      "Inserts a basic elsarticle with R mardown and makefile skeleton into a buffer."
      ;;"filename: "
      ;;(find-file "Makefile")
      "\n"
      "## Notes\n"
      "##  Must be able to process with latex and pdflatex\n\n"
      "## Usage\n"
      "##  make -i\n"
      "###   output: pdf document\n\n"
      ".SUFFIXES: .Rmd .tex .pdf .dvi .ps\n"
      "HIDE=default\n"
      "RmdFILES = $(wildcard *.Rmd)\n"
      "MD = $(patsubst %.Rmd,%.md,$(RmdFILES)) #$(wildcard *.md)\n"
      "TEX = $(patsubst %.Rmd,%.tex,$(RmdFILES))\n\n"
      "TARGET = " name "\n"
      ;;"LATEX_ARGS=--interaction=nonstopmode --output-driv=\"xdvipdfmx -vv -V 4\"\n"
    ;;  "PANDOC_ARGS=-s -S -i --template=template -H end.template -B start.template -A end1.template --mathjax --bibliography='/home/murray/Dropbox/Work/Resources/References/References.bib' --reference-links \n"
      "PANDOC_PDFLATEX_ARGS = -s --template='/home/murray/Dropbox/Work/Resources/Scripts/pandoc/elsarticle' --bibliography='/home/murray/Dropbox/Work/Resources/References/References.bib' --reference-links -N --latex-engine=pdflatex #--csl '/home/murray/Dropbox/Work/Resources/References/oecologia.csl' \n" 
      "PDFLATEX_ARGS=--interaction=nonstopmode --output-driv=\"xdvipdfmx -vv -V 4\"\n"
      "PANDOC=pandoc\n"
  
      "PDFS=$(wildcard figures/*.pdf)\n"
      "JPGS=$(patsubst %.pdf, %.jpg, $(PDFS))\n"
      "EPSS=$(patsubst %.pdf, %.eps, $(PDFS))\n"
      "CONVERT = convert -density 300 -resize 33% -background white -flatten\n\n"
      "#KNITRMD=$(patsubst %.Rmd, %_knit_.Rmd, $(RmdFILES))\n"

      "MASTER = " str ".html\n" 
      "DEPENDS = $(TARGET).md\n\n"

      ".SECONDARY:  #this is in place to prevent make from removing intermediatory files (like *.Lmd)\n"

      "%.Lmd: %.Rmd\n"
      "             echo $@\n"
      "             $(eval KNITRMD := $(patsubst %.Rmd, %_knit_.rmd, $<))\n"
      "             echo \"library(knitr); purl(\\\"$<\\\")\" | R --no-save --no-restore\n"
      "             cat *.R > all.R\n"
      "             cp $< $(KNITRMD)\n"
      "             sed -i -e '/<top>/{r /home/murray/Dropbox/Work/Resources/Scripts/knitHooksLatex' -e 'd}' $(KNITRMD)\n"  
      "             echo \"library(knitr); knit(\\\"$(KNITRMD)\\\",output=\\\"$@\\\")\" | R --no-save --no-restore\n"       
      "             sed -i \"s/caption{Table [0-9]*\.\ /caption{/g\" $@ #remove table counter - latex will do this\n\n"

      "%.tex: %.Lmd\n"
      "             $(eval TMP := $(patsubst %.Lmd, %.lmd, $<))\n"
      "             echo $(TMP)\n"
      "             cp $< $(TMP)\n"
      "ifeq ($(HIDE),TRUE)\n"
      "      sed -i '/<div class=\\\"hidden\\\".*>/,/^<\\/div class=\\\"hidden\\\">/d' $(TMP)\n"
      "endif\n"
      "             $(PANDOC) $(PANDOC_PDFLATEX_ARGS) -f 'markdown' *.lmd -o $(TARGET).tex\n\n"

      "pdf: $(TEX) #$(TARGET).tex\n"
      "             sed -i 's/includegraphics{images/includegraphics\\[width=\\\\maxwidth\\]{images/g' $(TARGET).tex\n"
      "             sed -i 's/\\\\centering/\\\\centering\\\\scriptsize/g' $(TARGET).tex #indicate smaller font for tables\n" 
      "             pdflatex $(PDFLATEX_ARGS) $(TARGET).tex\n"
      "             pdflatex $(PDFLATEX_ARGS) $(TARGET).tex\n"
      "             pdflatex $(PDFLATEX_ARGS) $(TARGET).tex\n\n"

  
      "figs: $(JPGS) $(EPSS)\n\n"

      "%.jpg: %.pdf\n"
      "             @echo ** Building jpg images from pdf versions**\n"
      "             $(CONVERT) $< $@\n\n"

      "%.eps: %.pdf\n"
      "             pdf2ps -dLanguageLevel=3 $< $@\n\n"

      "figures::\n" 
      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             convert -density 300 -quality 100 $${image_file} $${image_file}.jpg; \\\ \n"
      "             done;\n\n"

      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             convert -density 300 -quality 100 $${image_file} $${image_file}.tiff; \\\ \n"
      "             done;\n\n"

      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             pdftops -eps -level3 $${image_file}; \\\ \n"
      "             done;\n\n"

      "clean:\n"
      "     rm *.toc *.aux *.pdf *.ps *.eps *.log *.lof *.bib *.bbl *.blg *.dvi *.tex *.map *.md\n"
  
      "zip:\n"
      "             zip $(TARGET).zip $(TARGET).html *.R data/*.* figures/*.* scripts/*.* fonts/*.*\n"
      )


    (define-skeleton markdown-knitr-pandoc-makefile 
      "Inserts a basic markdown, knitr and pandoc makefile skeleton into a buffer."
      ;;"filename: "
      ;;(find-file "Makefile")
      "\n"
      "## Usage\n"
      "##  make html -i HIDE=TRUE\n"
      "###   output: html with hidden content\n"
      "##  make html -i\n"
      "###   output: html with revealed content\n"
      "##  make pdf -i HIDE=TRUE\n"
      "###   output: pdf with hidden content\n"
      "##  make pdf -i\n"
      "###   output: pdf with revealed content\n\n"
      ".SUFFIXES: .Rmd .html .rnw .tex .pdf .dvi .ps\n"
      "HIDE=default\n"
      "RmdFILES = $(wildcard *.Rmd)\n"
      "MD = $(patsubst %.Rmd,%.md,$(RmdFILES)) #$(wildcard *.md)\n"
      "TEX = $(patsubst %.Rmd,%.tex,$(RmdFILES))\n"
      "HMD = $(patsubst %.Rmd,%.hmd,$(RmdFILES))\n"
      "DOCX = $(patsubst %.Rmd,%.Dmd,$(RmdFILES))\n\n"
      "TARGET = " name "\n"
      ;;"LATEX_ARGS=--interaction=nonstopmode --output-driv=\"xdvipdfmx -vv -V 4\"\n"
    ;;  "PANDOC_ARGS=-s -S -i --template=template -H end.template -B start.template -A end1.template --mathjax --bibliography='/home/murray/Dropbox/Work/Resources/References/References.bib' --reference-links \n"
      "PANDOC_ARGS=-s -S -i --template='/home/murray/Dropbox/Work/Resources/Scripts/pandoc/template' --bibliography='/home/murray/Dropbox/Work/Resources/References/References.bib' --reference-links \n"
      "PANDOC_SC_ARGS =-s -S -i --template='/home/murray/Dropbox/Work/Resources/Scripts/pandoc/template_sc' --bibliography='/home/murray/Dropbox/Work/Resources/References/References.bib'  --reference-links  --self-contained #--csl '/home/murray/Dropbox/Work/Resources/References/oecologia.csl'\n"
      "PANDOC_XELATEX_ARGS = -s --template='/home/murray/Dropbox/Work/Resources/Scripts/pandoc/default' --bibliography='/home/murray/Dropbox/Work/Resources/References/References.bib' --reference-links -N --latex-engine=xelatex --toc #--csl '/home/murray/Dropbox/Work/Resources/References/oecologia.csl' \n" 
      "XELATEX_ARGS=--interaction=nonstopmode --output-driv=\"xdvipdfmx -vv -V 4\"\n"
      "XELATEX_ARGS=--interaction=batchmode\n"
      "PANDOC_DOC_ARGS=  -s -S -i --bibliography='/home/murray/Dropbox/Work/Resources/References/References.bib'  #--csl '/home/murray/Dropbox/Work/Resources/References/oecologia.csl' --reference-docx='/home/murray/Dropbox/Work/Resources/Templates/AIMS.docx'\n\n"
  
      "PANDOC=pandoc\n"
  
      "PDFS=$(wildcard figures/*.pdf)\n"
      "JPGS=$(patsubst %.pdf, %.jpg, $(PDFS))\n"
      "EPSS=$(patsubst %.pdf, %.eps, $(PDFS))\n"
      "CONVERT = convert -density 300 -resize 33% -background white -flatten\n\n"
      "#KNITRMD=$(patsubst %.Rmd, %_knit_.Rmd, $(RmdFILES))\n"

      "MASTER = " str ".html\n" 
      "DEPENDS = $(TARGET).md\n\n"

      ".SECONDARY:  #this is in place to prevent make from removing intermediatory files (like *.Lmd)\n"
      "%.Dmd: %.Rmd\n"
      "             echo $@\n"
      "             $(eval KNITRMD := $(patsubst %.Rmd, %_knit_.dmd, $<))\n"
      "             cp $< $(KNITRMD)\n"
      "             sed -i 's/<top>//g' $(KNITRMD)\n"
      "             sed -i 's/\\\({r.*\\\)}/\\\1, dpi=400}/g' $(KNITRMD)\n"
      "             #echo \"library(knitr); purl(\\\"$<\\\")\" | R --no-save --no-restore\n"
      "             echo \"library(knitr); knit(\\\"$(KNITRMD)\\\",output=\\\"$@\\\")\" | R --no-save --no-restore\n\n"

      "docx: $(DOCX)\n"
      "             $(PANDOC) $(PANDOC_DOC_ARGS) *.Dmd -o $(TARGET).docx\n\n"

      "%.Lmd: %.Rmd\n"
      "             echo $@\n"
      "             $(eval KNITRMD := $(patsubst %.Rmd, %_knit_.rmd, $<))\n"
      "             echo \"library(knitr); purl(\\\"$<\\\")\" | R --no-save --no-restore\n"
      "             cat *.R > all.R\n"
      "             cp $< $(KNITRMD)\n"
      "             sed -i \"s/='png'/='pdf'/g\" $(KNITRMD) #produce pdf graphics\n"
      "             sed -i \"s/='html'/='latex'/g\" $(KNITRMD) #produce latex tables\n"
      "             sed -i \"s/sanitize.colnames.function=NULL/sanitize.colnames.function=bold.names/g\" $(KNITRMD) #produce latex tables\n"
      "             sed -i -e '/<top>/{r /home/murray/Dropbox/Work/Resources/Scripts/knitHooksLatex' -e 'd}' $(KNITRMD)\n"  
      "             echo \"library(knitr); knit(\\\"$(KNITRMD)\\\",output=\\\"$@\\\")\" | R --no-save --no-restore\n"       
      "             sed -i \"s/caption{Table [0-9]*\.\ /caption{/g\" $@ #remove table counter - latex will do this\n\n"


      "%.tex: %.Lmd\n"
      "             $(eval TMP := $(patsubst %.Lmd, %.lmd, $<))\n"
      "             echo $(TMP)\n"
      "             cp $< $(TMP)\n"
      "ifeq ($(HIDE),TRUE)\n"
      "      sed -i '/<div class=\\\"hidden\\\".*>/,/^<\\/div class=\\\"hidden\\\">/d' $(TMP)\n"
      "endif\n"
      "             $(PANDOC) $(PANDOC_XELATEX_ARGS) -f 'markdown' *.lmd -o $(TARGET).tex\n\n"

      "pdf: $(TEX) #$(TARGET).tex\n"
      "             sed -i 's/includegraphics{images/includegraphics\\[width=\\\\maxwidth\\]{images/g' $(TARGET).tex\n"
      "             sed -i 's/\\\\centering/\\\\centering\\\\scriptsize/g' $(TARGET).tex #indicate smaller font for tables\n" 
      "             xelatex $(XELATEX_ARGS) $(TARGET).tex\n"
      "             xelatex $(XELATEX_ARGS) $(TARGET).tex\n"
      "             xelatex $(XELATEX_ARGS) $(TARGET).tex\n\n"

      "%.Hmd: %.Rmd\n"
      "             $(eval KNITRMD := $(patsubst %.Rmd, %_knit_.rmd, $<))\n"
      "             echo \"library(knitr); purl(\\\"$<\\\")\" | R --no-save --no-restore\n"
      "             cat *.R > all.R\n"
      "             cp $< $(KNITRMD)\n"  
      "             sed -i -e '/<top>/{r /home/murray/Dropbox/Work/Resources/Scripts/knitHooks' -e 'd}' $(KNITRMD)\n"
      "             echo \"library(knitr); knit(\\\"$(KNITRMD)\\\",output=\\\"$@\\\")\" | R --no-save --no-restore\n\n"             

      "%.hmd: %.Hmd\n"
      "             $(eval TMP := $(patsubst %.Hmd, %_knit_.hmd, $<))\n"
      "             cp $< $(TMP)\n"
      "ifeq ($(HIDE),TRUE)\n"
      "      sed -i '/<div class=\\\"hidden\\\".*>/,/^<\\/div class=\\\"hidden\\\">/d' $(TMP)\n"
      "endif\n\n"

      "html: $(HMD)\n"
      "             $(PANDOC) $(PANDOC_ARGS) *.hmd > $(TARGET).html\n"
      "             sed -i -e '/?config=TeX-AMS_HTML-full/' -e 'd}' *.hmd\n"
      "             $(PANDOC) $(PANDOC_SC_ARGS) *.hmd > $(TARGET)_sc.html\n\n"
  
      "figs: $(JPGS) $(EPSS)\n\n"

      "%.jpg: %.pdf\n"
      "             @echo ** Building jpg images from pdf versions**\n"
      "             $(CONVERT) $< $@\n\n"

      "%.eps: %.pdf\n"
      "             pdf2ps -dLanguageLevel=3 $< $@\n\n"

      "figures::\n" 
      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             convert -density 300 -quality 100 $${image_file} $${image_file}.jpg; \\\ \n"
      "             done;\n\n"

      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             convert -density 300 -quality 100 $${image_file} $${image_file}.tiff; \\\ \n"
      "             done;\n\n"

      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             pdftops -eps -level3 $${image_file}; \\\ \n"
      "             done;\n\n"

      "clean:\n"
      "     rm *.toc *.aux *.pdf *.ps *.eps *.log *.lof *.bib *.bbl *.blg *.dvi *.tex *.map *.md\n"
  
      "zip:\n"
      "             zip $(TARGET).zip $(TARGET).html *.R data/*.* figures/*.* scripts/*.* fonts/*.*\n"
      )


    (define-skeleton elsarticle-R-skeleton
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "---\n"
      "type: review,3p\n"
      "title: '" str "'\n"
      "author:\n"
      "- name: M. Logan\n"
      "  af: aims\n"
      "  affiliation: Australian Institute of Marine Science, PMB No 3, Townsville, Queensland 4810, Australia\n"
      "keyword: Bla, Bla, Bla\n"
      "abstract: |\n"
      " This is the abstract.\n\n"
      " With two paragraphs.\n"
      "...\n\n"
      "<top>\n\n"
      "\n"


      "```{r libraries, echo=FALSE}\n"
      "library(dplyr)\n"
      "library(reshape2)\n"
      "library(ggplot2)\n"
      "library(grid)\n"
      "library(gridExtra)\n"
      "library(lubridate)\n"
      "```\n\n"
  
      "Introduction\n"
      "===================\n\n"

      "Methods\n"
      "===================\n\n"

      "Results\n"
      "===================\n\n"

      "Discussion\n"
      "===================\n\n"

      "References\n"
      "====================\n\n"


    )

    (define-skeleton markdown-knitr-pandoc-skeleton
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "% " str "\n"
      "% " author "\n"
      "% " (format-time-string "%d-%m-%Y" (current-time)) "\n\n"
      "<top>\n\n"
      "\n"


      "Preparations\n"
      "===================\n"

      "## Read in data\n\n"
      "```{r, reveal=TRUE}\n"
      "a <- 100\n"
      "a\n"
      "```\n\n"

      "References\n"
      "====================\n"
      "This document was produced from markdown using knitr on `r version$version.string` on a `r version$platform` system.\n\n"

      "```{r, results='markdown'}\n"
      "sessionInfo()\n"
      "```\n\n"

    )

    (define-skeleton markdown-knitr-pandoc-skeleton-01
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "% " str "\n"
      "% " author "\n"
      "% " (format-time-string "%d-%m-%Y" (current-time)) "\n\n"
      "<top>\n\n"
      "\n"


      "Data importation\n"
      "===================\n"
      "## Load libraries\n\n"
      "```{r libraries, reveal=TRUE, results='markdown'}\n"
      "source('helperFunctions.R')\n"
      "\n"
      "```\n"
      "## Read in data\n\n"
      "```{r readData, reveal=TRUE, results='markdown'}\n"
      "a <- 100\n"
      "a\n"
      "```\n"
    )

    (define-skeleton markdown-knitr-pandoc-skeleton-helperFunctions
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "## The following are helper Functions\n\n"
    )

    (define-skeleton markdown-knitr-pandoc-skeleton-02
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "<top>\n\n"
      "\n"

      "Data processing\n"
      "===================\n"
      "## Process the data\n\n"
      "```{r, reveal=TRUE, results='markdown'}\n"
      "a <- 100\n"
      "a\n"
      "```\n"
    )

    (define-skeleton markdown-knitr-pandoc-skeleton-05
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "<top>\n\n"
      "\n"

      "Data analysis\n"
      "===================\n"
      "## Read in data\n\n"
      "```{r, reveal=TRUE, results='markdown'}\n"
      "a <- 100\n"
      "a\n"
      "```\n\n"
      "Generalized Additive Mixed Models [GAMMs; @Wood-2006-2006].\n"
    )

    (define-skeleton markdown-knitr-pandoc-skeleton-07
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "<top>\n\n"
      "\n"

      "Summaries\n"
      "===================\n"
      "## Read in data\n\n"
      "```{r, reveal=TRUE,results='markdown'}\n"
      "a <- 100\n"
      "a\n"
      "```\n"
    )

    (define-skeleton markdown-knitr-pandoc-skeleton-09
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "<top>\n\n"
      "\n"

      "Appendix\n"
      "====================\n"
      "This document was produced from markdown using knitr on `r version$version.string` on a `r version$platform` system.\n\n"
      "```{r, reveal=TRUE,results='markdown'}\n"
      "a <- system('cat all.R',intern=TRUE)\n"
      "a <- gsub('## ----.*','',a)\n"
      "a <- paste(a,collapse='\\n')\n"
      "a<-gsub('\\n\\n\\n\\n\\n','\\n\\n',a)\n"
      "cat(paste(a,collapse='\\n'))\n"

      "```\n"

      "References\n"
      "====================\n"
  


    )

    (define-skeleton markdown-knitr-templates
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "## The following are templates that can be pasted into a Rmd file\n\n"
      "### Inserting in-text citations"
      "Generalized Additive Mixed Models [GAMMs; @Wood-2006-2006].\n"
      "### Tables\n"

    )
    ;; ----End of markdown-knitr-pandoc---------------------------------------------------






    (defun knitr-xelatex ()
      ;;  (interactive "sfilename:?")
      (interactive)
      (setq var (split-string (read-from-minibuffer "Enter filename: "nil nil nil nil nil nil) " "))
      (setq name (car var))
      (shell-command "mkdir figures")
      (shell-command "mkdir cache")
      (shell-command "mkdir data")
      (find-file "Makefile")
      (xelatex-knitr-makefile name)
      (save-buffer)
      (kill-buffer "Makefile")
      (find-file (concat name ".rnw"))
      (xelatex-knitr-skeleton)
      (save-buffer)
      )

    (define-skeleton xelatex-knitr-makefile 
      "Inserts a basic noweb xelatex with knitr makefile skeleton into a buffer."
      ;;"filename: "
      ;;(find-file "Makefile")
      ".SUFFIXES: .rnw .tex .pdf .dvi .ps\n"
      "RNWFILES = $(wildcard *.rnw)\n"
      "TEX = $(patsubst %.rnw,%.tex,$(RNWFILES)) #$(wildcard *.tex)\n"
      "TARGET = " name "\n"
      ;;"LATEX_ARGS=--interaction=nonstopmode --output-driv=\"xdvipdfmx -vv -V 4\"\n"
      "LATEX_ARGS=--interaction=batchmode\n"
      ;;  "LATEX_ARGS=\"-interaction=nonstopmode\"\n"
      "LATEX=xelatex\n"
      "RERUNBIB = \"No file.*\\\ .bbl|Citation.*undefined\"\n"
      "RERUNINDEX = \"No file.*\\\ .ind\"\n\n"
  
      "PDFS=$(wildcard figures/*.pdf)\n"
      "JPGS=$(patsubst %.pdf, %.jpg, $(PDFS))\n"
      "EPSS=$(patsubst %.pdf, %.eps, $(PDFS))\n"
      "CONVERT = convert -density 300 -resize 33% -background white -flatten\n\n"

      "MASTER = " str ".pdf\n" 
      "DEPENDS = $(TARGET).tex\n\n"
      "$(MASTER): $(DEPENDS)\n\n"
  
      "%.tex: %.rnw\n"
    ;;  "           echo \"library(pgfSweave); setCacheDir('cache'); pgfSweave(\\\"$<\\\")\" | R --no-save --no-restore\n\n"
      "             echo \"library(knitr); knit(\\\"$<\\\")\" | R --no-save --no-restore\n\n"
    ;;  "           echo \"Stangle(\\\"$<\\\")\" | R --no-save --no-restore\n\n"
      "             echo \"library(knitr); purl(\\\"$<\\\")\" | R --no-save --no-restore\n\n"  
    ;;  "       echo \"library(pgfSweave); setCacheDir('cache'); pgfSweave(\\\"$<\\\", graphics.only=T,compile.tex=F,pdf=F)\" | R --no-save --no-restore\n\n"
    ;;  "           echo \"library(cacheSweave); library(highlight); setCacheDir('cache'); Sweave(\\\"$<\\\", driver = HighlightWeaveLatex(boxes=T,bg=rgb(255,255,204,max=255)))\" | R --no-save --no-restore \n"
    ;;  "             echo \"library(cacheSweave); setCacheDir('cache'); Sweave(\\\"$<\\\", driver = cacheSweaveDriver)\" | R --no-save --no-restore\n\n"
    ;;  "           echo \"Stangle(\\\"$<\\\")\" | R --no-save --no-restore\n\n"
    ;;  "           echo \"sed s/,.size=scriptsize//g \\\"$<\\\" > junk\" \n"
    ;;  "           echo \"Stangle(\\\"junk\\\",output=\\\"$(TARGET).R\\\")\" | R --no-save --no-restore\n\n"
    ;;  "           echo \"rm(junk)\" \n"
 
      "$(TARGET).pdf: $(TEX)\n"
      "     $(LATEX) $(LATEX_ARGS) $(TARGET).tex;\n"
      "     while \\\ egrep -c $(RERUNBIB) $(TARGET).log; \\\ \n"
      "     do \\\ \n"
      "             bibtex $(TARGET); \\\ \n"
      "             $(LATEX) $(LATEX_ARGS) $(TARGET).tex; \\\ \n"
      "     done\n"
      "     while \\\ grep -q \"Rerun to get cross-references right.\" \\\ \n"
      "     $(TARGET).log; \\\ \n"
      "     do \\\ \n"
      "             $(LATEX) $(LATEX_ARGS) $(TARGET).tex; \\\ \n"
      "     done\n"
    ;;  "   $(LATEX) $(LATEX_ARGS) $(TARGET).tex;\n\n"
  
      "figs: $(JPGS) $(EPSS)\n\n"

      "%.jpg: %.pdf\n"
      "             @echo ** Building jpg images from pdf versions**\n"
      "             $(CONVERT) $< $@\n\n"

      "%.eps: %.pdf\n"
      "             pdf2ps -dLanguageLevel=3 $< $@\n\n"

      "figures::\n" 
      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             convert -density 300 -quality 100 $${image_file} $${image_file}.jpg; \\\ \n"
      "             done;\n\n"

      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             convert -density 300 -quality 100 $${image_file} $${image_file}.tiff; \\\ \n"
      "             done;\n\n"

      "             for image_file in $(wildcard figures/*.pdf); \\\ \n"
      "             do \\\ \n"
      "                             pdftops -eps -level3 $${image_file}; \\\ \n"
      "             done;\n\n"

      "clean:\n"
      "     rm *.toc *.aux *.pdf *.ps *.eps *.log *.lof *.bib *.bbl *.blg *.dvi *.tex *.map\n"
  
      "zip:\n"
      "             zip $(TARGET).zip $(TARGET).pdf *.R figures/*.* \n"
      )

    ;;-- xelatex template ########################################################-------------------------------------------------------------------------------------
    (define-skeleton xelatex-knitr-skeleton
      "Inserts a basic LaTeX Noweb skeleton into the current buffer."
      "Document title: "
      "\\SweaveOpts{background='#FFFFCC',cache.path='cache/',fig.path='figures/fig',fig.align='center',prompt=TRUE, highlight=TRUE,comment=NA, results='markup', par=TRUE}\n"
      "\\title{" str "}\n"
      "\\documentclass[a4paper]{article}\n"
      "\\newif\\iffinished\n"
      "\\finishedtrue\n"
      "\\iffinished\n"
      "\\usepackage[T1]{fontenc}        %for specifying any fonts\n"
      "\\usepackage{calligra}\n"
      "\\usepackage{rotating}           %for sideways tables\n"
      "\\usepackage{marvosym}\n"
      "\\usepackage{listings}                   %provides lstset for formating inserted computer code\n"
      "\\usepackage{tabularx}           %for tables\n"
      "\\usepackage{color,graphicx}\n"
      "\\usepackage[table]{xcolor}\n"
      "\\usepackage{colortbl}\n"
      "\\usepackage{tikz}\n"
      "\\renewcommand{\\familydefault}{\\sfdefault}\n"
      "\\usetikzlibrary{backgrounds}\n"
      "\\usetikzlibrary{shadows}\n"
      "\\usepackage{wrapfig}\n"
      "\\usepackage[lmargin=1.75cm,rmargin=1.5cm, tmargin=1.5cm, a4paper]{geometry}\n"
      "%-----Define Provision for bibliography-----------\n"
      "\\usepackage{natbib}\n"
      "\\usepackage{bibentry}\n"
      "%-------------------------------------------------\n"
      "\\usepackage{bbding}\n"
      "%---Define some colors--------------------------\n"
      "\\definecolor{backgroundColor}{HTML}{CC3300}\n"
      "\\definecolor{linkcolour}{HTML}{393939} %{FF0080}    %light purple link for the email\n"
      "\\definecolor{shade}{HTML}{D4D7FE}           %light blue shade\n"
      "\\definecolor{text1}{HTML}{2b2b2b}           %text is almost black\n"
      "\\definecolor{headings}{HTML}{0099e3}        %light blue\n"
      "\\definecolor{lightgray}{gray}{0.9}          %light gray\n"
      "\\definecolor{rinput}{HTML}{FF0000}     %dark blue\n"
      "\\definecolor{routput}{HTML}{033197}     %dark blue\n"
      "\\definecolor{rbackground}{HTML}{FFFFCC}\n"
      "%-------------------------------------------------\n"
      "\\usepackage{hyperref}\n"
      "\\hypersetup{colorlinks,breaklinks,urlcolor=linkcolour,linkcolor=linkcolour, citecolor=routput}\n"
      "\\renewcommand*\\sfdefault{lmssq}\n"
      "%-Redefine the section title formats--------------\n"
      "\\usepackage{titlesec}\n"
      "\\titleformat{\\section}{\\Large\\sf\\bfseries\\raggedright\\color{headings}\\thesection. }{}{0em}{}[\\titlerule]\n"
      "\\titlespacing{\\section}{0pt}{3pt}{3pt}\n"
      "\\titleformat{\\subsection}{\\large\\sf\\bfseries\\itshape\\raggedright\\color{headings}\\thesubsection. }{}{0em}{}\n"
      "\\titlespacing{\\subsection}{0pt}{3pt}{3pt}\n"
      "\\titleformat{\\subsubsection}{\\normalsize\\sf\\bfseries\\itshape\\raggedright\\color{headings}\\thesubsubsection. }{}{0em}{}\n"
      "\\titlespacing{\\subsubsection}{0pt}{3pt}{3pt}\n"
      "%-------------------------------------------------\n"
      "%---Define a new list style-----------------------\n"
      "\\newenvironment{my_itemize}\n"
      "\{\\begin{list}{\\labelitemi}{\\leftmargin=1em}\n"
      "\}\n"
      "\{\\end{list}}\n"
      "%-------------------------------------------------\n"
      "\\usepackage{eso-pic}\n"
      "%--Put a silhouette at the bottom of the page-----\n"
      "\\graphicspath{{\\string~/Dropbox/Work/Resources/Images/}}\n"
      "\\newcommand\\BackgroundPic{\n"
      "\\put(-10,0){\n"
      "\\parbox[b][\\paperheight]{\\paperwidth}{%\n"
      "\\includegraphics[width=220mm, height=20mm]{header.png}%\n"
      "\\vfill\n"
      "\\includegraphics{footer.png}%\n"
      "\}}}\n"
      "%-------------------------------------------------\n"
      "%--Put a blue bar on the left hand side of the page---\n"
      "%\\newcommand\\SidePic{\n"
      "%\\put(-30,\\pageheight){\n"
      "%\\includegraphics[width=23mm, height=31cm]{/home/murray/Work/Resume/blueSide.png}\n"
      "%\\hspace{-2mm}{\\color{gray}\\rule{.5mm}{300mm}}{\\color{black}\\rule{.25mm}{300mm}}\n"
      "%\}}\n"
      "%-------------------------------------------------\n"
      "%--Place   DRAFT ONLY  on each page---------------\n"
      "\\usepackage{fontspec}\n"
      "\\newcommand\\DraftWord{\n"
      "\\AtTextCenter{%\n"
      "\\makebox(0,0)[c]{\\resizebox{\\textwidth}{!}{%\n"
      "\\rotatebox{45}{\\textsf{\\textbf{\\color{lightgray}{\\fontspec[ExternalLocation=\\string~/Dropbox/Config/Fonts/]{angelina.TTF}\\fontsize{80pt}{0pt}\\selectfont Draft Only}}}}\n"
      "\}}\n"
      "\}\n"
      "\}\n"
      "\\fi\\n"
      "%-------------------------------------------------\n"
      "\\pretolerance=2000\n"
      "\\tolerance=2000\n"
      "%\\usepackage[noae]{/usr/local/lib/R/share/texmf/Sweave}\n"
      "\\usepackage[noae]{Sweave}\n"
      "\\iffinished\n"
      "%--Alter the default format of the R code/output--\n"
      "\\DefineVerbatimEnvironment{Sinput}{Verbatim}{fontsize=\\scriptsize,fontshape=sl,formatcom={\\color{rinput}}}\n"
      "\\DefineVerbatimEnvironment{Soutput}{Verbatim}{\\vspace{-2em},fontsize=\\scriptsize,formatcom={\\color{routput}}}\n" 
      "\\DefineVerbatimEnvironment{Scode}{Verbatim}{fontshape=sl,formatcom={\\color{headings}}}\n" 
      "\\fvset{listparameters={\\setlength{\\topsep}{1em}}}\n"
      "%\\renewenvironment{Houtput}{%\n"
      "% \\begin{scriptsize}\n"
      "%    \\color{routput}\n"
      "%    \\par\n"
      "%    \\tikzexternaldisable\n"
      "%    \\begin{tikzpicture}\n"
      "%      \\node[fill=rbackground,rectangle,minimum width=0.9\\textwidth] (m)\n"
      "%      \\bgroup\\begin{minipage}{0.85\\textwidth}%\n"
      "%}\n"
      "%{%\n"
      "%  \\end{minipage}\\egroup;\n"
      "%  \\draw[dashed] (m.south west) rectangle (m.north east);\n"
      "%  \\end{tikzpicture}\n"
      "%  \\end{scriptsize}\n"
      "%\\\\ \n" 
      "%}\n"

      "\\definecolor{highlightBg}{rgb}{1,1,0.8}\n"
      "\\definecolor{highlightBorder}{rgb}{0,0,0}\n"
      "\\definecolor{white}{rgb}{1,1,1}\n"
      "\\definecolor{orangeColor}{HTML}{FF9900}\n"

      "%\\renewenvironment{Hchunk}{% \n"
      "% \\color{routput}\n"
      "% \\par\n"
      "% \\begin{tikzpicture}\n"
      "%  \\node[fill=rbackground,rectangle,minimum width=0.9\\textwidth] (m)\n"
      "%  \\bgroup\\begin{minipage}{0.85\\textwidth}%\n"
      "%}{%\n"
      "%  \\end{minipage}\\egroup;\n"
      "%  \\draw[dashed] (m.south west) rectangle (m.north east);\n"
      "%  \\end{tikzpicture}\\\\ \n" 
      "%}\n"

      "%\\newenvironment{elaboration}{%\n"
      "%  \\par\n"
      "%  \\begin{tikzpicture}\n"
      "%  \\node[fill=rbackground,rectangle,minimum width=0.9\textwidth] (m)\n"
      "%  \\bgroup\\begin{minipage}{0.85\\textwidth}%\n"
      "% }{%\n"
      "%  \\end{minipage}\\egroup;\n"
      "%  \\draw[dashed] (m.south west) rectangle (m.north east);\n"
      "%  \\end{tikzpicture}\\\\ \n"
      "% }\n"

      "%\\makeatletter\n"
      "%\\renewenvironment{Schunk}{\\begin{elaboration}}{\\end{elaboration}}\n"
      "%\\makeatother\n"

      "%\\renewenvironment{Schunk}{\\vspace{\\topsep}}{\\vspace{\\topsep}}\n"
      "%-------------------------------------------------\n"
      "%--Change the format of the captions--------------\n"
      "% Different font in captions\n"
      "\\newcommand{\\captionfonts}{\\small\\sf}\n"
      "\\makeatletter  % Allow the use of @ in command names\n"
      "\\long\\def\\@makecaption#1#2{%\n"
      "\\vskip\\abovecaptionskip\n"
      "\\sbox\\@tempboxa{{\\captionfonts #1: \\em#2}}%\n"
      "\\ifdim \\wd\\@tempboxa >\\hsize\n"
      "{\\captionfonts #1: \\em#2\\par}\n"
      "\\else\n"
      "\\hbox to\\hsize{\\hfil\\box\\@tempboxa\\hfil}%\n"
      "\\fi\n"
      "\\vskip\\belowcaptionskip}\n"
      "\\makeatother   % Cancel the effect of \\makeatletter\n"
      "%-------------------------------------------------\n"
      "%--Change the page formatting---------------------\n"
      "% Change the format of the page numbers\n"
      "\\usepackage{fancyhdr}\n"
      "\\pagestyle{fancy}\n"
      "\\fancyhf{} % clear all header and footer fields\n"
      "\\fancyhead[RE,LO]{\\hfill\\bfseries\\sf \\color{white}\\thepage}\n"
      "%\\fancyfoot[RE,LO]{\\hfill\\bfseries\\sf \\thepage}\n"
      "\\renewcommand{\\headrulewidth}{0pt}\n"
      "%-------------------------------------------------\n"
      "%--Change the name used for the table of contents-\n"
      "\\renewcommand{\\contentsname}{Table of contents}\n"
      "%-------------------------------------------------\n"

      "\\setlength\\parindent{0pt}\n"
      "\\setmonofont[Scale=MatchLowercase, ExternalLocation=\\string~/Dropbox/Config/Fonts/]{DejaVuSansMono.ttf}\n"
      "\\renewcommand{\\hlcomment}[1]{\\textcolor[HTML]{3C802C}{#1}}%\n"
      "\\renewcommand{\\hlstring}[1]{\\textcolor[HTML]{ED7722}{#1}}%\n"
      "\\renewcommand{\\hlfunctioncall}[1]{\\textcolor[HTML]{053369}{#1}}%\n"
      "\\renewcommand{\\hlnumber}[1]{\\textcolor[HTML]{0F20F6}{#1}}%\n"
      "\\renewcommand{\\hlkeyword}[1]{\\textcolor[HTML]{AA1F63}{\\textbf{#1}}}%\n"
      "\\renewcommand{\\hlargument}[1]{\\textcolor[HTML]{053369}{#1}}%\n"

      "\\setbox\\hlnormalsizeboxopenbrace=\\hbox{\\begin{scriptsize}\\verb.{.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxclosebrace=\\hbox{\\begin{scriptsize}\\verb.}.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxlessthan=\\hbox{\\begin{scriptsize}\\verb.<.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxdollar=\\hbox{\\begin{scriptsize}\\verb.$.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxunderscore=\\hbox{\\begin{scriptsize}\\verb._.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxand=\\hbox{\\begin{scriptsize}\\verb.&.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxhash=\\hbox{\\begin{scriptsize}\\verb.#.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxat=\\hbox{\\begin{scriptsize}\\verb.@.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxbackslash=\\hbox{\\begin{scriptsize}\\verb.\\.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxgreaterthan=\\hbox{\\begin{scriptsize}\\verb.>.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxpercent=\\hbox{\\begin{scriptsize}\\verb.%.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxhat=\\hbox{\\begin{scriptsize}\\verb.^.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxsinglequote=\\hbox{\\begin{scriptsize}\\verb.'.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxbacktick=\\hbox{\\begin{scriptsize}\\verb.`.\\end{scriptsize}}%\n"
      "\\setbox\\hlnormalsizeboxhat=\\hbox{\\begin{scriptsize}\\verb.^.\\end{scriptsize}}%\n"

      "\\usepackage{multirow}\n"
      "\\usepackage{wasysym}\n"

      "\\renewenvironment{kframe}{%\n"
      " \\begin{scriptsize}\n"
      "   \\color{routput}\n"
      "   \\par\n"
      "   \\tikzexternaldisable\n"
      "     \\begin{tikzpicture}\n"
      "       \\node[fill=rbackground,rectangle,minimum width=\\textwidth] (m)\n"
      "       \\bgroup\\begin{minipage}{0.95\\textwidth}%\n"
      " }\n"
      " {%\n"
      "   \\end{minipage}\\egroup;\n"
      "   \\draw[dashed] (m.south west) rectangle (m.north east);\n"
      "   \\end{tikzpicture}\n"
      "   \\end{scriptsize}\n"
      " \\\n"
      " }\n"

    "\\fi\n"

      "\\begin{document}\n"
      "\\iffinished\n"
      "\\sf\n"
      "\\AddToShipoutPicture{\\BackgroundPic}\n"
      "%\\AddToShipoutPicture{\\SidePic}\n"
      "\\AddToShipoutPicture{\\DraftWord}\n"
      "%<<Setcache - THIS CODE SHOULD BE IGNORED, echo=F>>=\n"
      "%# The following step requires the cacheSweave package\n"
      "%setCacheDir(\"cache\")\n"
      "%reSQL<-TRUE\n"
      "%@\n\n" 

      "\\lstset{basicstyle=\\small\\ttfamily,columns=fixed,numbers=left,numberstyle=\\tiny,xleftmargin=3ex,xrightmargin=3ex,frame=lines,float=htb!}\n"
      "\\fi\n"
      "\n" _ "\n\n"
      "<<Rwidth, echo=FALSE, results=\"hide\">>=\n"
      "options(width=110)\n"
      "@\n\n"
      "\\iffinished\n"
      "\\noindent\\begin{minipage}[t]{\\linewidth}{%centering\n"
      "{\\noindent\\sffamily\\bfseries\\Huge " str "\n"
      "}\\\\[1em]\n"
      "\\large{Murray Logan}\\\\ \n"
      "\\normalsize\\textit{\\today}\n"
      "\\end{minipage}\\\\ \n" 

      "\\rule{\\linewidth}{2pt}\\\\[2pt]\n"
  
      "\\titleformat{\\section}{\\Large\\sf\\bfseries\\raggedright\\color{headings}}{}{0em}{}[\\titlerule]\n"
      "\\noindent\n"
      "{\\tikzexternaldisable\n"
      "\\begin{tikzpicture}\n"
      "\\node [fill=shade,rounded corners=5pt]\n"
      "{\n"
      "\\begin{minipage}[t]{\\textwidth}\n"  
      "\\tableofcontents\n"
      "\\end{minipage}\n"
      "};\n"
      "\\end{tikzpicture}\n"
      "}\n"
      "\\titleformat{\\section}{\\Large\\sf\\bfseries\\raggedright\\color{headings}\\thesection. }{}{0em}{}[\\titlerule]\n"
      "\\fi\n"

      "\\section{Data importation and preparation}\n"
      "\\subsection{Read in data}\n"
      "<<ReadData, tidy=TRUE>>=\n"
      "#this is a comment\n"
      "a<-100\n"
      "a\n"
      "#data <- read.table('data.csv', header=T, sep=',', strip.white=T)\n"
      "@\n"
      "\\subsection{Prepare data}\n"

      "\\iffinished\n"
      "\\noindent\n"
      "{\\tikzexternaldisable\n"
      "\\begin{tikzpicture}\n"
      "\\node [fill=shade,rounded corners=5pt]\n"
      "{\n"
      "\\begin{minipage}[t]{\\textwidth}\n"  
      "\\textbf{Conclusions}.\n"
      "\\end{minipage}\n"
      "};\n"
      "\\end{tikzpicture}}\n"

      "\\addcontentsline{toc}{section}{References and additional reading}\\titleformat{\\section}{\\Large\\sf\\bfseries\\raggedright\\color{headings}}{}{0em}{}[\\titlerule]\n"
      "\\bibliographystyle{\\string~/Dropbox/Work/Resources/References/ecology}\n"
      "\\bibliography{\\string~/Dropbox/Work/References/References}\n" 
      "~\\\\[2em]\n"
      "<<sanitize, echo=F>>=\n"
      "sanitize <- function(x) gsub(\"_\",\"\\\\\\\\_\", x, fixed=TRUE)\n"
      "@\n"
      "\\addcontentsline{toc}{section}{Appendices}\n"
      "\\appendix{\\Large\\sf\\bfseries\\raggedright\\color{headings} Appendicies \\\\[0.3em]\\titlerule\\\\[0.1em]}\n"
      "\\titleformat{\\subsection}{\\large\\sf\\bfseries\\itshape\\raggedright\\color{headings}\\Alph{subsection}. }{}{0em}{}\n"
      "\\renewcommand{\\thesubsection}    {\\Alph{subsection}}\n"
      "\\subsection{Production notes}\n"
      "\\noindent This document was produced using \\LaTeX~ and \\Sexpr{print(version$version.string)} via knitr, on a system:$\\Sexpr{sanitize(version$platform)}$.\n"
      "The complete annotated R syntax is in the accompanying " name ".R file.\n"

      "%<<CreateRFile - THIS CODE SHOULD BE IGNORED, echo=FALSE>>=\n"
      "%Stangle('"name ".rnw')\n"
      "%@\n" 
      "\\fi\n"
      "\\end{document}\n")
    ;;------------END OF R-xelatex-----------------------------------------------------------------------------------------------------------------------------------

    (define-skeleton xelatex-rnw-xtable
      "Inserts a basic R table into xelatex."
      "Table location: "
      (interactive)
      "<<hooks, echo=FALSE>>=\n"
      "old_hook <- knit_hooks$get()$chunk\n"
      "knit_hooks$set(chunk=function(x, options){x})\n"
      "@\n\n" 
      "\\begin{table}[" str "]\n"
      "\\sf\n"
      "\\caption{" (setq v1 (skeleton-read "Caption? ")) "}\\label{tab:"  (setq v2 (skeleton-read "label? ")) "}\n"
      "\\begin{tabularx}{\\linewidth}{xll}\n"
      "\\hline\n"
      "\\textbf{A}&\\textbf{B}&\\textbf{C}\\\\\n"
      "\\hline\n"
      "<<Name, echo=F, results=tex>>=\n"
      "print(xtable(" (setq v3 (skeleton-read "tab? ")) ",digits=c(0,4,0)),NA.string='NA',hline.after=NULL,include.rownames=F,floating=FALSE,only.contents=T,include.colnames=F,sanitize.text.function=function(x) x, sanitize.rownames.function=function(x) x)\n"
      "@\n"
      "\\hline\n"
      "\\end{tabularx}\n"
      "\\end{table}\n"
      "<<restore_hooks, echo=FALSE>>=\n"
      "knit_hooks$set(chunk=old_hook)\n"
      "@\n"
    )

    (define-skeleton xelatex-color-table
      "Inserts a color table into xelatex."
      "Table location: "
      (interactive)
      "\\arrayrulecolor{orangeColor}\n"
      "\\rowcolors[\\hline]{3}{orangeColor!15}{white}\n"
      "\\begin{table}[hptb]\n"
      "  \\begin{minipage}[h]{1.0\\linewidth}\n"
      "    \\begin{tabularx}{\\linewidth}{|Xlclllccc|}\n"
      "      \\hline\n"
      "      \\rowcolor{orangeColor}&&&&&&\\textcolor{white}{\\textbf{Enrol.}}&\\textcolor{white}{\\textbf{Enrol. per}}&\n"
      "      \\textcolor{white}{\\textbf{Enrol. per}}\\\\\n"
      "      \\rowcolor{orangeColor}\\textcolor{white}{\\textbf{Faculty}}&\n"
      "      \\textcolor{white}{\\textbf{Unit}}&\n"
      "      \\textcolor{white}{\\textbf{Sem.}}&\n"
      "      \\textcolor{white}{\\textbf{Campus}\\footnote{B=Berwick, CA=Caulfield, CL=Clayton, G=Gippsland, M=Malaysia, P=Peninsula, S=South Africa}}&\n"
      "      \\textcolor{white}{\\textbf{LMS 2011}}&\n"
      "      \\textcolor{white}{\\textbf{LMS 2012}}&\n"
      "      \\textcolor{white}{\\textbf{range\\footnote{Range of enrollment sizes across the campuses and years}}}&\n"
      "      \\textcolor{white}{\\textbf{campus\\footnote{Mean enrollment size per campus/year}}}&\n"
      "      \\textcolor{white}{\\textbf{year\\footnote{The mean of the total enrollment across all campuses per year}}}\\\\\n"
      "      \\hline\n"
      "      Arts&ATS1325&1&B,CA,CL,M,S&Blackboard&Blackboard&18-283&137.6&619.0\\\\\n"
      "      Arts&ATS1328&1&CA,M,S&Blackboard&Blackboard&34-165&80.7&242.0\\\\\n"
      "      Arts&ATS1365&1&CA,CL,S&Blackboard&Blackboard&94-200&125.0&376.5\\\\\n"
      "      Arts&ATS1371&1&CA,CL,S&Blackboard&Moodle&39-192&94.5&283.5\\\\\n"
      "      Buseco&AFW1002&2&B,G,M,P,S&Blackboard&Blackboard&2-210&78.2&391.0\\\\\n"
      "      Buseco&ECW1102&2&B,G,M,P,S&Blackboard&Blackboard&8-208&101.1&455.0\\\\\n"
      "      Buseco&ETC1000&1&CL,M&Blackboard&Blackboard&9-484&244.3&488.5\\\\      \n"
      "      Buseco&MGW1010&1&B,G,M,P,S&Blackboard&Blackboard&29-400&177.7&799.5\\\\  \n"
      "      Edu&EDF1303&1&B,CL,G,P&Blackboard&Blackboard&33-99&73.6&257.5\\\\\n"
      "      Edu&EDF1305&1&G,P&Blackboard&Blackboard&35-47&42.0&84.0\\\\\n"
      "      \\hline\n"
      "    \\end{tabularx}\n"
      "  \\end{minipage}\n"
      "  \\caption{Basic enrollment characteristics of the units selected as data for the learning analytics prototype.}\n"
      "  \\label{tab:unitSelections}\n"
    "\\end{table}\n"
    "}\n"
    )

    (define-skeleton xelatex-sideways-table
      "Inserts a color table into xelatex."
      "Table location: "
      (interactive)
      "<<hooks, echo=FALSE>>=\n"
      "old_hook <- knit_hooks$get()$chunk\n"
      "knit_hooks$set(chunk=function(x, options){x})\n"
      "@\n"  
      "\\begin{sidewaystable}[htbp]\n"
      "\\sf\n"
      "\\caption{Estimated mean (95\\% HPS interval) DAS (Depression, Anxiety and Stress) scores associated with survery 1 and 2 (semester 1 and 2 respectively) along with the pairwise mean difference (Effect) and percentage effect (Effect expressed as a percentage of survey 1 score).  The probability that the percent effect is greater than 0, 5\\% and 10\\% are also included. Median and percentage finite-population variance components (in standard deviation units) are provided for the levels of Student, Survey and Residuals.}\\label{tab:aa}\n"
      "\\begin{tabularx}{\\linewidth}{X@{\\extracolsep{0.5em}}\n"
      "    c@{\\extracolsep{1em}}l@{\\extracolsep{0.5em}}l@{\\extracolsep{0.5em}}l@{\\extracolsep{1em}}\n"
      "    c@{\\extracolsep{1em}}l@{\\extracolsep{0.5em}}l@{\\extracolsep{0.5em}}l@{\\extracolsep{1em}}\n"
      "    c@{\\extracolsep{1em}}l@{\\extracolsep{0.5em}}l@{\\extracolsep{0.5em}}l@{\\extracolsep{0.5em}}}\n"
      "\\toprule\n"
      "&\\multicolumn{4}{c}{\\textbf{Depression}}&\\multicolumn{4}{c}{\\textbf{Anxiety}}&\\multicolumn{4}{c}{\\textbf{Stress}}\\\\\n"
      "\\cmidrule(c){2-5}\\cmidrule(c){6-9}\\cmidrule(c){10-13}\n"
      "&\\textbf{Mean}&\\multicolumn{3}{c}{\\textbf{Prob. increase}}&\\textbf{Mean}&\\multicolumn{3}{c}{\\textbf{Prob. increase}}&\\textbf{Mean}&\\multicolumn{3}{c}{\\textbf{Prob. increase}}\\\\\n"
      "\\cmidrule(c){3-5}\\cmidrule(c){7-9}\\cmidrule(c){11-13}\n"
      "\\textbf{Source}&\\textbf{(95\\% HPD)}&\\textbf{>0\\%}&\\textbf{>5\\%}&\\textbf{>10\\%}&\\textbf{(95\\% HPD)}&\\textbf{>0\\%}&\\textbf{>5\\%}&\\textbf{>10\\%}&\\textbf{(95\\% HPD)}&\\textbf{>0\\%}&\\textbf{>5\\%}&\\textbf{>10\\%}\\\\\n"
      "\\midrule \n"
      "<<JAGStable, echo=FALSE, results='asis'>>=\n"
      "library(xtable)\n"
      "#prepare\n"
      "sum.D$HPD <- sprintf(\"%6.2f (%6.2f - %6.2f)\",sum.D$mean,sum.D$lower.1, sum.D$upper.1)\n"
      "sum.A$HPD <- sprintf(\"%6.2f (%6.2f - %6.2f)\",sum.A$mean,sum.A$lower.1, sum.A$upper.1)\n"
      "sum.S$HPD <- sprintf(\"%6.2f (%6.2f - %6.2f)\",sum.S$mean,sum.S$lower.1, sum.S$upper.1)\n"
      "sums <- cbind(sum.D[,c(4,8,5:7)],sum.A[,c(8,5:7)],sum.S[,c(8,5:7)])\n"
      "print(xtable(sums,digits=c(0,0,0,rep(2,3),0,rep(2,3),0,rep(2,3))),NA.string='',hline.after=NULL,include.rownames=F,floating=FALSE,only.contents=T,include.colnames=F,sanitize.text.function=function(x) x, sanitize.rownames.function=function(x) x)\n"
      "@\n"
      "\\midrule\n"
      "&\\multicolumn{2}{c}{\\textbf{Var. comp.}}&&&\\multicolumn{2}{c}{\\textbf{Var. comp.}}&&&\\multicolumn{2}{c}{\\textbf{Var. comp.}}&&\\\\\n"
      "\\cmidrule(c){2-3}\\cmidrule(c){6-7}\\cmidrule(c){10-11}\n"
      "&\\textbf{Median}&\\textbf{\\%}&&&\\textbf{Median}&\\textbf{\\%}&&&\\textbf{Median}&\\textbf{\\%}&&\\\\\n"
      "%\\multicolumn{3}{l}{\\textsl{Variance components (sd)}}\\\\\n"
      "<<JAGStable2, echo=FALSE, results='asis'>>=\n"
      "library(xtable)\n"
      "#prepare\n"
      "sd.D$HPD <- sprintf(\"%6.2f (%6.2f - %6.2f)\",sd.D$median,sd.D$lower.1, sd.D$upper.1)\n"
      "sd.A$HPD <- sprintf(\"%6.2f (%6.2f - %6.2f)\",sd.A$median,sd.A$lower.1, sd.A$upper.1)\n"
      "sd.S$HPD <- sprintf(\"%6.2f (%6.2f - %6.2f)\",sd.S$median,sd.S$lower.1, sd.S$upper.1)\n"
      "sds <- cbind(sd.D[,c(5,6,4)],matrix(rep(NA,6),ncol=2),sd.A[,c(6,4)],matrix(rep(NA,6),ncol=2),sd.S[,c(6,4)],matrix(rep(NA,6),ncol=2))\n"
      "print(xtable(sds,digits=c(0,0,0,rep(2,3),0,rep(2,3),0,rep(2,3))),NA.string='',hline.after=NULL,include.rownames=F,floating=FALSE,only.contents=T,include.colnames=F,sanitize.text.function=function(x) x, sanitize.rownames.function=function(x) x)\n"
      "@\n"
      "\\bottomrule\n"
      "\\end{tabularx}\n"
      "\\end{sidewaystable}\n"
      "<<restore_hooks, echo=FALSE>>=\n"
      "knit_hooks$set(chunk=old_hook)\n"
      "@\n" 
    )


    ;; load-nas-music
    ;; -------------------
    ;; Create a playlist from the MBW network drive 
    ;; Bind it to C-c C-n
    (defun load-nas-music ()
      "Create a playlist from the MBW network drive."
      (interactive)
        (emms-add-directory-tree "/mnt/MBWpublic/Shared Music/Music")
      )
     (define-key global-map [(control c) (control n)] 'load-nas-music) ; Bind to C-c C-n

    (defun load-local-music ()
      "Create a playlist from the local drive."
      (interactive)
        (emms-add-directory-tree "~/music")
      )
     (define-key global-map [(control c) (control m)] 'load-local-music) ; Bind to C-c C-m








    ;; Show important emacs keys
    (defun show-emacs-keys()
      "Display a series of useful emacs key bindings"
      (interactive)
      (let ((mkeys (concat
                                    "===================================================================\n"
                                    "                   Common Emacs Key bindings                       \n"
                                    "===================================================================\n"
                                    " C-c SPC     Jump to a word     |  M-p             Jump to a window\n"
                                    )))
            (if (fboundp 'with-displaying-help-buffer)
                    (with-displaying-help-buffer
                     (lambda ()
                       (princ mkeys)) "Emacs keys")
              (with-output-to-temp-buffer "Emacs keys"
                    (princ mkeys)))))


    (defun show-mkeys()
             "Display a series of useful emacs key bindings."
             (interactive)
             (find-file-other-frame "~/Dropbox/org/notes.org")
             (search-forward "Quick commands" nil nil 1) (setq p1 (point))
             (search-forward "** BUFFER" nil nil 1) (setq p2 (point)) 
             (narrow-to-region p1 p2)
             (show-all)
    )

    ;;(pos-tip-show STRING &optional TIP-COLOR POS WINDOW TIMEOUT WIDTH FRAME-COORDINATES DX DY)
    ;;Note, the popup menu gets its color, font etc from gtk
    ;;In order for this to look OK, you need to set the Font to a monospace font
    ;; Settings -> User Interface Settings
    ;; (defun ml-show-mkeys()
    ;;       "Display a series of useful emacs key bindings."
    ;;       (interactive)
    ;;       (pos-tip-show
    ;;        (with-temp-buffer
    ;;              (insert-file-contents "~/Dropbox/org/notes.org")
    ;;              (search-forward "Quick commands" nil nil 1) (setq p1 (point))
    ;;              (search-forward "** BUFFER" nil nil 1) (setq p2 (point))
    ;;              (narrow-to-region p1 p2)
    ;;              (buffer-string)
    ;;              )
    ;;        nil nil nil 0)
    ;;       )
    (defun ml-show-mkeys(x)
             "Display a series of useful emacs key bindings."
             (interactive "sChoice (q=quick, p=popup): ")
             (pos-tip-show
              (with-temp-buffer
                    (insert-file-contents "~/Dropbox/org/notes.org")
                    (if (equal x "q") (progn (search-forward "Quick commands" nil nil 1) (setq p1 (point))))
                    (if (equal x "p") (progn (search-forward "POPUP shortcuts" nil nil 1) (setq p1 (point))))
                    (search-forward "*" nil nil 1) (setq p2 (point))
                    (narrow-to-region p1 p2)
                    (buffer-string)
                    )
              nil nil nil 0)
             )
    (global-set-key (kbd "C-'") 'ml-show-mkeys)


    ;; (defun ml-load-files (x)
    ;;   "Load notes.org"
    ;;   (interactive "sChoice (n=notes, a=AIMS):")
    ;;   (if (equal x "n") (find-file "~/Dropbox/org/notes.org"))
    ;;   (if (equal x "a") (find-file "~/Dropbox/org/AIMS.org"))

    ;; )
    ;; (global-set-key (kbd "C-c f") 'ml-load-files)

    (defun ml-load-files-notes ()
      "Load notes.org"
      (interactive)
      (find-file "~/Dropbox/org/notes.org")
      )
    (global-set-key (kbd "C-c f n") 'ml-load-files-notes)
    (defun ml-load-files-AIMS ()
      "Load AIMS.org"
      (interactive)
      (find-file "~/Dropbox/org/AIMS.org")
      )
    (global-set-key (kbd "C-c f a") 'ml-load-files-AIMS)
    (defun ml-load-files-references ()
      "Load references.org"
      (interactive)
      (find-file "~/Dropbox/org/references.org")
      )
    (global-set-key (kbd "C-c f r") 'ml-load-files-references)
    (defun ml-load-files-bib ()
      "Load References.bib"
      (interactive)
      (find-file "~/Dropbox/Work/Resources/References/References.bib")
      )
    (global-set-key (kbd "C-c f b") 'ml-load-files-bib)
    (defun ml-load-files-init ()
      "Load init.el"
      (interactive)
      (find-file "~/.emacs.d/init.el")
      )
    (global-set-key (kbd "C-c f i") 'ml-load-files-init)




    ;; ===========================================================================
    ;; The Menu
    ;; ===========================================================================

    ;; This adds a small menu for my little macros up above and other
    ;; additions.  This makes it relatively easy to access them in
    ;; Emacs (although the hotkeys are certainly more efficient.)
    ;;
    (let ((menu '("Murray"
               ("Files" 
                            ["notes.org" ml-load-files-notes]
                            ["AIMS.org" ml-load-files-AIMS]
                            ["references.org" ml-load-files-references]
                            ["References.bib" ml-load-files-bib]
                            ["init.el" ml-load-files-init]
                       )
               ("Mounting"
                            ["mount MBWpublic" (shell-command (concat "echo " (shell-quote-argument (read-passwd "Password? "))" | sudo mount -t cifs //192.168.1.2/Public /mnt/MBWpublic -o user=murray,password=merycism,uid=1000"))]
                            ["umount MBWpublic" (shell-command (concat "echo " (shell-quote-argument (read-passwd "Password? "))" | sudo -S umount /mnt/MBWpublic"))]
                ["mount MBWmurray" (shell-command (concat "echo " (shell-quote-argument (read-passwd "Password? "))" | sudo -S mount -t cifs //192.168.1.2/Murray /mnt/MBWmurray -o user=murray,password=merycism,uid=1000"))]
                            ["umount MBWmurray" (shell-command (concat "echo " (shell-quote-argument (read-passwd "Password? "))" | sudo -S umount /mnt/MBWmurray"))]
                            ["AIMS vpn" (shell-command (concat "echo " (shell-quote-argument (read-passwd "Password? "))" | sudo -S vpnc AIMS.conf"))]
                            )
               ("Text file editing"
                   ["Strip Trailing" strip-trailing-space]
                   ["Goto Longest Line" goto-longest-line]
                   )
                  ["ASCII Chart" show-ascii-chart]
              ;;["Emacs Keys" show-emacs-keys]
                      ;;["Emacs KeysA" show-mkeys]
                      ["Show keys" ml-show-mkeys]
                      ;;["Emacs Keyss" (find-file-other-frame "~/Dropbox/org/notes.org")]
                      ;;["Emacs Keyss" (shell-command "cat ~/Dropbox/org/notes.org | sed -rn '/Quick commands/,/BUFFERS/{/(Quick commands|BUFFERS)/d;p;}'")]
                      ;;["Emacs KeyssB" (pos-tip-show (with-temp-buffer (shell-command "cat ~/Dropbox/org/notes.org | sed -rn '/Quick commands/,/BUFFERS/{/(Quick commands|BUFFERS)/d;p;}'") (buffer-string)))]
                  ["Goto Matching Paren" goto-matching-paren]
                  ["Speedbar" speedbar]
                  ("HTMLize"
                   ["Buffer" htmlize-buffer]
                   ["File" htmlize-file])
                  ("R, LaTeX and HTML"
                       ["small-markdown-knitr-pandoc" small-markdown-knitr-pandoc]
                       ["large-markdown-knitr-pandoc" large-markdown-knitr-pandoc]
                       ["elsarticle-R" elsarticle-R]
                       ["knitr-xelatex" knitr-xelatex]
                   ["R-xelatex" R-xelatex]
                       ("Tables"
                            ["xtable" xelatex-rnw-xtable]
                            ["color-table" xelatex-color-table]
                            ["color-table" xelatex-sideways-table]
                            )
                       )
                      ("Music"
                       ["Load NAS music" load-nas-music]
                       ["Load local music" load-local-music]
                       ;;["Volume down" emms-volume-lower]
                       ;;["Volume up" emms-volume-raise]
                       ["Pause" emms-pause]
                       )
    )))

      (if (fboundp 'add-submenu)
          (add-submenu nil menu)
        (require 'easymenu)
        (easy-menu-define -menu global-map "Murray's Personal Menu" menu)
        (easy-menu-add murrays-menu global-map)))

  #+END_SRC

